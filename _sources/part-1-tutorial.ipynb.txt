{
 "cells": [
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "# Part 1: Building a Recommendation System for Explicit Feedback Datasets\n",
    "\n",
    "We will be using a [MovieLens](https://movielens.org/) dataset to build a simple recommendation system in Python. MovieLens is a platform where users rate movies, and get personalized recommendations based on their preferences. It has several publicly available datasets that are widely used for recommendation system tutorials.\n",
    "\n",
    "MovieLens is an **explicit feedback** dataset. Ratings represent a user's direct feedback towards a movie. An example of implicit feedback would be duration of time a user has spent watching a movie."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Import Dependencies"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "metadata": {},
   "outputs": [],
   "source": [
    "import numpy as np\n",
    "import pandas as pd\n",
    "import sklearn\n",
    "import matplotlib.pyplot as plt\n",
    "import seaborn as sns\n",
    "\n",
    "import os\n",
    "import warnings\n",
    "warnings.simplefilter(action='ignore', category=FutureWarning)"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Import Dataset"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Let's download a small version of the MovieLens dataset. See [here](https://grouplens.org/datasets/movielens/) for zip file url, or directly download [here](http://files.grouplens.org/datasets/movielens/ml-latest-small.zip). We're working with data in `ml-latest-small.zip` and will need to add the following files to our repository: \n",
    "- ratings.csv\n",
    "- movies.csv\n",
    "\n",
    "We can use pandas' `read_csv` method which reads csv files into a pandas dataframe. For the code below to work, move the appropriate csv files into a directory called `data/`."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 12,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>userId</th>\n",
       "      <th>movieId</th>\n",
       "      <th>rating</th>\n",
       "      <th>timestamp</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>1</td>\n",
       "      <td>31</td>\n",
       "      <td>2.5</td>\n",
       "      <td>1260759144</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>1</td>\n",
       "      <td>1029</td>\n",
       "      <td>3.0</td>\n",
       "      <td>1260759179</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>1</td>\n",
       "      <td>1061</td>\n",
       "      <td>3.0</td>\n",
       "      <td>1260759182</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>1</td>\n",
       "      <td>1129</td>\n",
       "      <td>2.0</td>\n",
       "      <td>1260759185</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>1</td>\n",
       "      <td>1172</td>\n",
       "      <td>4.0</td>\n",
       "      <td>1260759205</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "   userId  movieId  rating   timestamp\n",
       "0       1       31     2.5  1260759144\n",
       "1       1     1029     3.0  1260759179\n",
       "2       1     1061     3.0  1260759182\n",
       "3       1     1129     2.0  1260759185\n",
       "4       1     1172     4.0  1260759205"
      ]
     },
     "execution_count": 12,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "ratings = pd.read_csv(os.path.join(\"data\", \"ratings.csv\"))\n",
    "ratings.head()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 13,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>movieId</th>\n",
       "      <th>title</th>\n",
       "      <th>genres</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>1</td>\n",
       "      <td>Toy Story (1995)</td>\n",
       "      <td>Adventure|Animation|Children|Comedy|Fantasy</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>2</td>\n",
       "      <td>Jumanji (1995)</td>\n",
       "      <td>Adventure|Children|Fantasy</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>3</td>\n",
       "      <td>Grumpier Old Men (1995)</td>\n",
       "      <td>Comedy|Romance</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>4</td>\n",
       "      <td>Waiting to Exhale (1995)</td>\n",
       "      <td>Comedy|Drama|Romance</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>5</td>\n",
       "      <td>Father of the Bride Part II (1995)</td>\n",
       "      <td>Comedy</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "   movieId                               title  \\\n",
       "0        1                    Toy Story (1995)   \n",
       "1        2                      Jumanji (1995)   \n",
       "2        3             Grumpier Old Men (1995)   \n",
       "3        4            Waiting to Exhale (1995)   \n",
       "4        5  Father of the Bride Part II (1995)   \n",
       "\n",
       "                                        genres  \n",
       "0  Adventure|Animation|Children|Comedy|Fantasy  \n",
       "1                   Adventure|Children|Fantasy  \n",
       "2                               Comedy|Romance  \n",
       "3                         Comedy|Drama|Romance  \n",
       "4                                       Comedy  "
      ]
     },
     "execution_count": 13,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "movies = pd.read_csv(os.path.join(\"data\", \"movies.csv\"))\n",
    "movies.head()"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Exploratory Data Analysis"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Let's take a look at the data and perform some basic exploratory data analysis."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 14,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Number of ratings: 100004\n",
      "Number of unique movieId's: 9066\n",
      "Number of unique users: 671\n",
      "Average number of ratings per user: 149.04\n",
      "Average number of ratings per movie: 11.03\n"
     ]
    }
   ],
   "source": [
    "n_ratings = len(ratings)\n",
    "n_movies = ratings['movieId'].nunique()\n",
    "n_users = ratings['userId'].nunique()\n",
    "\n",
    "print(\"Number of ratings:\", n_ratings)\n",
    "print(\"Number of unique movieId's:\", n_movies)\n",
    "print(\"Number of unique users:\", n_users)\n",
    "print(\"Average number of ratings per user:\", round(n_ratings/n_users, 2))\n",
    "print(\"Average number of ratings per movie:\", round(n_ratings/n_movies, 2))"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 15,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "image/png": "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\n",
      "text/plain": [
       "<Figure size 432x288 with 1 Axes>"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    }
   ],
   "source": [
    "ax = sns.countplot(x=\"rating\", data=ratings, palette=\"GnBu\")\n",
    "plt.title(\"Distribution of movie ratings\")\n",
    "plt.show()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 16,
   "metadata": {},
   "outputs": [],
   "source": [
    "user_freq = ratings[['userId', 'movieId']].groupby('userId').count()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 17,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "Text(0.5,1,'Number of movies rated per user')"
      ]
     },
     "execution_count": 17,
     "metadata": {},
     "output_type": "execute_result"
    },
    {
     "data": {
      "image/png": "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\n",
      "text/plain": [
       "<Figure size 432x288 with 1 Axes>"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    }
   ],
   "source": [
    "ax = sns.kdeplot(user_freq['movieId'], shade=True)\n",
    "\n",
    "# add vertical line to represent mean\n",
    "plt.axvline(user_freq['movieId'].mean(), color=\"k\", linestyle=\"--\")\n",
    "\n",
    "# add x/y labels and title\n",
    "ax.set(xlabel='# ratings per user', ylabel='density')\n",
    "plt.title(\"Number of movies rated per user\")"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Which movie had the lowest average rating?"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 25,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>movieId</th>\n",
       "      <th>title</th>\n",
       "      <th>genres</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>1062</th>\n",
       "      <td>1311</td>\n",
       "      <td>Santa with Muscles (1996)</td>\n",
       "      <td>Comedy</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "      movieId                      title  genres\n",
       "1062     1311  Santa with Muscles (1996)  Comedy"
      ]
     },
     "execution_count": 25,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "mean_rating = ratings.groupby('movieId')[['rating']].mean()\n",
    "lowest_rated = mean_rating['rating'].idxmin()\n",
    "movies.loc[movies['movieId'] == lowest_rated]"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Which movie had the highest average rating?"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 26,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>movieId</th>\n",
       "      <th>title</th>\n",
       "      <th>genres</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>50</th>\n",
       "      <td>53</td>\n",
       "      <td>Lamerica (1994)</td>\n",
       "      <td>Adventure|Drama</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "    movieId            title           genres\n",
       "50       53  Lamerica (1994)  Adventure|Drama"
      ]
     },
     "execution_count": 26,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "highest_rated = mean_rating['rating'].idxmax()\n",
    "movies.loc[movies['movieId'] == highest_rated]"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Transforming the data"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "We need to transform our dataframe into a sparse matrix such that rows represents users and columns represent items. This is called a **utility matrix** and forms the basis of collaborative filtering. Remember: collaborative filtering is a technique that identifies similar users and recommends what similar users like. It does not require any user or item features! \n",
    "\n",
    "<img src=\"images/user-movie-matrix.png\" width=\"500px\" align=\"left\">"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "The `create_X()` function outputs a sparse matrix X with four mapper dictionaries:\n",
    "- **user_mapper:** maps user id to user index\n",
    "- **movie_mapper:** maps movie id to movie index\n",
    "- **user_inv_mapper:** maps user index to user id\n",
    "- **movie_inv_mapper:** maps movie index to movie id\n",
    "\n",
    "We need these dictionaries because they map which row/column of the utility matrix corresponds to which user/item ID."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 94,
   "metadata": {},
   "outputs": [],
   "source": [
    "from scipy.sparse import csr_matrix\n",
    "\n",
    "def create_X(df):\n",
    "    \"\"\"\n",
    "    Generates a sparse matrix from ratings dataframe.\n",
    "    \n",
    "    Args:\n",
    "        df: pandas dataframe\n",
    "    \n",
    "    Returns:\n",
    "        X: sparse matrix\n",
    "        user_mapper: dict that maps user id's to user indices\n",
    "        user_inv_mapper: dict that maps user indices to user id's\n",
    "        movie_mapper: dict that maps movie id's to movie indices\n",
    "        movie_inv_mapper: dict that maps movie indices to movie id's\n",
    "    \"\"\"\n",
    "    N = df['userId'].nunique()\n",
    "    M = df['movieId'].nunique()\n",
    "\n",
    "    user_mapper = dict(zip(np.unique(df[\"userId\"]), list(range(N))))\n",
    "    movie_mapper = dict(zip(np.unique(df[\"movieId\"]), list(range(M))))\n",
    "    \n",
    "    user_inv_mapper = dict(zip(list(range(N)), np.unique(df[\"userId\"])))\n",
    "    movie_inv_mapper = dict(zip(list(range(M)), np.unique(df[\"movieId\"])))\n",
    "    \n",
    "    user_index = [user_mapper[i] for i in df['userId']]\n",
    "    item_index = [movie_mapper[i] for i in df['movieId']]\n",
    "\n",
    "    X = csr_matrix((df[\"rating\"], (item_index, user_index)), shape=(M, N))\n",
    "    \n",
    "    return X, user_mapper, movie_mapper, user_inv_mapper, movie_inv_mapper"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 95,
   "metadata": {},
   "outputs": [],
   "source": [
    "X, user_mapper, movie_mapper, user_inv_mapper, movie_inv_mapper = create_X(ratings)"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Let's check out the sparsity of our X matrix.\n",
    "\n",
    "Here, we calculate sparsity by dividing the number of non-zero elements by total number of elements. \n",
    "\n",
    "$$S=\\frac{\\text{# non-zero elements}}{\\text{total # elements}}$$"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 170,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Matrix sparsity: 1.64%\n"
     ]
    }
   ],
   "source": [
    "sparsity = X.count_nonzero()/(X.shape[0]*X.shape[1])\n",
    "\n",
    "print(\"Matrix sparsity: {0:.2f}%\".format(sparsity*100))"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Finding similar movies using k-Nearest Neighbours\n",
    "\n",
    "We will first cover **memory-based** collaborative filtering."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 96,
   "metadata": {},
   "outputs": [],
   "source": [
    "from sklearn.neighbors import NearestNeighbors\n",
    "\n",
    "def find_similar_movies(movie_id, X, k, metric=None):\n",
    "    \"\"\"\n",
    "    Finds k-nearest neighbours for a given movie id.\n",
    "    \n",
    "    Args:\n",
    "        movie_id: id of the movie of interest\n",
    "        X: user-item utility matrix\n",
    "        k: number of similar movies to retrieve\n",
    "        metric: distance metric for kNN calculations, default is set to euclidean\n",
    "    \n",
    "    Output: returns list of k similar movie ID's\n",
    "    \"\"\"\n",
    "    if metric == None:\n",
    "        metric = 'euclidean'\n",
    "\n",
    "    neighbour_ids = []\n",
    "    \n",
    "    movie_ind = movie_mapper[movie_id]\n",
    "    movie_vec = X[movie_ind]\n",
    "    k+=1\n",
    "    kNN = NearestNeighbors(n_neighbors=k, algorithm=\"brute\", metric=metric)\n",
    "    kNN.fit(X)\n",
    "    if isinstance(movie_vec, (np.ndarray)):\n",
    "        movie_vec = movie_vec.reshape(1,-1)\n",
    "    neighbour = kNN.kneighbors(movie_vec, return_distance=False)\n",
    "    for i in range(0,k):\n",
    "        n = neighbour.item(i)\n",
    "        neighbour_ids.append(movie_inv_mapper[n])\n",
    "    neighbour_ids.pop(0)\n",
    "    return neighbour_ids"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 97,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Because you watched  Toy Story (1995)\n",
      "Toy Story 2 (1999)\n",
      "Bug's Life, A (1998)\n",
      "Groundhog Day (1993)\n",
      "Independence Day (a.k.a. ID4) (1996)\n",
      "Monsters, Inc. (2001)\n",
      "Finding Nemo (2003)\n",
      "Incredibles, The (2004)\n",
      "Shrek (2001)\n",
      "Willy Wonka & the Chocolate Factory (1971)\n",
      "Mission: Impossible (1996)\n"
     ]
    }
   ],
   "source": [
    "movie_titles = dict(zip(movies['movieId'], movies['title']))\n",
    "\n",
    "movie_id = 1\n",
    "\n",
    "similar_ids = find_similar_movies(movie_id, X, k=10)\n",
    "\n",
    "print(\"Because you watched \", movie_titles[movie_id])\n",
    "for i in similar_ids:\n",
    "    print(movie_titles[i])"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Pretty cool!\n",
    "\n",
    "You can also play around with the kNN distance metric and see what results you would get if you use \"manhattan\" instead of \"euclidean\"."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 84,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Because you watched  Toy Story (1995)\n",
      "Toy Story 2 (1999)\n",
      "Star Wars: Episode IV - A New Hope (1977)\n",
      "Forrest Gump (1994)\n",
      "Independence Day (a.k.a. ID4) (1996)\n",
      "Groundhog Day (1993)\n",
      "Back to the Future (1985)\n",
      "Jurassic Park (1993)\n",
      "Shrek (2001)\n",
      "Star Wars: Episode VI - Return of the Jedi (1983)\n",
      "Pulp Fiction (1994)\n"
     ]
    }
   ],
   "source": [
    "movie_titles = dict(zip(movies['movieId'], movies['title']))\n",
    "\n",
    "movie_id = 1\n",
    "\n",
    "similar_ids = find_similar_movies(movie_id, X, k=10, metric=\"cosine\")\n",
    "\n",
    "print(\"Because you watched \", movie_titles[movie_id])\n",
    "for i in similar_ids:\n",
    "    print(movie_titles[i])"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Advanced: in the section below, we transform the sparse matrix X to lower dimensions using Single Vector Decomposition (SVD). "
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 88,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Because you watched  Toy Story (1995)\n",
      "Toy Story 2 (1999)\n",
      "Bug's Life, A (1998)\n",
      "Independence Day (a.k.a. ID4) (1996)\n",
      "Groundhog Day (1993)\n",
      "Monsters, Inc. (2001)\n",
      "Incredibles, The (2004)\n",
      "Finding Nemo (2003)\n",
      "Shrek (2001)\n",
      "Babe (1995)\n",
      "Twister (1996)\n"
     ]
    }
   ],
   "source": [
    "svd = TruncatedSVD(n_components=200, n_iter=10, random_state=42)\n",
    "Z = svd.fit_transform(X)\n",
    "similar_ids = find_similar_movies(movie_id, Z, k=10)\n",
    "\n",
    "print(\"Because you watched \", movie_titles[movie_id])\n",
    "for i in similar_ids:\n",
    "    print(movie_titles[i])"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Matrix Factorization\n",
    "\n",
    "Can we accurately predict a user's movie preferences?"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 121,
   "metadata": {},
   "outputs": [],
   "source": [
    "from sklearn.model_selection import train_test_split\n",
    "from sklearn.decomposition import TruncatedSVD\n",
    "\n",
    "ratings_train, ratings_test = train_test_split(ratings, test_size=0.2, random_state=42)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 122,
   "metadata": {},
   "outputs": [],
   "source": [
    "X_train, _, _, _, _ = create_X(ratings_train)\n",
    "X_test, _, _, _, _ = create_X(ratings_test)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 145,
   "metadata": {},
   "outputs": [],
   "source": [
    "def root_mean_squared_error(X_pred, X_test):\n",
    "    return np.nanmean((X_pred-X_test)**2)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 146,
   "metadata": {},
   "outputs": [],
   "source": [
    "avg = csr_matrix.mean(X_train)\n",
    "X_pred = np.zeros(X_train.shape)+avg"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 147,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "0.19141917371090814"
      ]
     },
     "execution_count": 147,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "score(X_pred, X_train.toarray())"
   ]
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.6.5"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 2
}
